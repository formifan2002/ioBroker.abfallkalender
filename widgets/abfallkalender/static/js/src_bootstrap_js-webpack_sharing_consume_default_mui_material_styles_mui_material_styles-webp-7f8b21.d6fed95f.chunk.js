"use strict";(self.webpackChunkiobroker_vis_widgets_abfallkalender=self.webpackChunkiobroker_vis_widgets_abfallkalender||[]).push([["src_bootstrap_js-webpack_sharing_consume_default_mui_material_styles_mui_material_styles-webp-7f8b21"],{10736:function(ie,z,i){i.r(z);var W=i(96056),O=i(4819),l=i.n(O),j=i(83413),x=i(75606),m=i(58503),P={en:i(86443),de:i(19837),ru:i(50482),pt:i(65909),nl:i(43573),fr:i(86115),it:i(79399),es:i(55117),pl:i(28130),uk:i(17138),"zh-cn":i(58246)},g=i(82490),L=i(84854),$=i(35069),D=i(65267),R=i(26750),E=i(7784),M=i(68723),S=i(88411),J=i(10458),A=i(84543),h=i(84998),b=(f,t,e)=>new Promise((a,n)=>{var s=r=>{try{c(e.next(r))}catch(u){n(u)}},o=r=>{try{c(e.throw(r))}catch(u){n(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(s,o);c((e=e.apply(f,t)).next())});const B=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class C extends(window.visRxWidget||S.VisRxWidget){constructor(t){super(t),this.changeData=h.aw.bind(this),this.arr2string=h.mR.bind(this),this.getInstances=h.il.bind(this),this.refTrashIcon=l().createRef(),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.wastetypeLocal=this.state.data.wastetype,this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplAbfallIcon",visSet:"abfallkalender",visSetLabel:"vis_2_widgets_abfallkalender",visSetColor:"#63C149",visName:x.i18n.t("vis_2_widgets_abfallkalender_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(t,e,a)=>h.ZP.showInstances(t,e,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_abfallkalender_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(t,e,a)=>this.showWasteTypes(t,e,a)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_abfallkalender_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_abfallkalender_icontrash"},{value:"yellowbag",label:"vis_2_widgets_abfallkalender_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_abfallkalender_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_abfallkalender_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_abfallkalender_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_abfallkalender_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_abfallkalender_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(t,e,a)=>h.ZP.showCheckbox(t,e,a)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_abfallkalender_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(t,e,a)=>h.ZP.showCheckbox(t,e,a)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_abfallkalender_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_abfallkalender_showdate",type:"custom",component:(t,e,a)=>h.ZP.showCheckbox(t,e,a)},{name:"dateformat",default:"short",label:"vis_2_widgets_abfallkalender_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_abfallkalender_showdays",type:"custom",component:(t,e,a)=>h.ZP.showCheckbox(t,e,a)},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(t,e,a)=>h.ZP.showFontfamily(t,e,a,["fontsize"])},{name:"fontsize",default:20,label:"vis_2_widgets_abfallkalender_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/trash.png"}}propertiesUpdate(){return b(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:t,instancename:e}=this.state.data;let a=!0;typeof e!="undefined"&&this.instancenameLocal!==e&&(this.instancenameLocal=e,yield this.getWasteTypes(e),a=!1),(this.oidChange===!0||typeof t!="undefined"&&this.wastetypeLocal!==t)&&(this.wastetypeLocal=t,yield this.getJsonObject(t,this.instancenameLocal),yield this.updateWhatsappAndBlink(),a=!0,this.oidChange===!0&&(this.oidChange=!1)),a===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),g.ZP.init(A.Z).then(()=>{g.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(t=>{this.getWasteTypes(t).then(e=>{this.getJsonObject(e,t).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return C.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(t,e){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return b(this,null,function*(){const{trashcolor:t,trashcolorfactor:e,fontfamily:a,fontsize:n,whatsapplogo:s,dateformat:o,blink:c,blinkinterval:r,showdate:u,showdays:ee}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(d=>{if(d.id==="Abfalltonne"){d.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let p="";d.childNodes.forEach(y=>{if(y.id==="tonne"&&(t===""?(this.state.data.trashcolor=y.attributes.fill.nodeValue,p=y.attributes.fill.nodeValue):(y.attributes.fill.nodeValue=this.state.data.trashcolor,p=this.state.data.trashcolor)),y.id==="tonne-innen"&&typeof p!="undefined"){const T=p.replace("rgba(","").replace(")","").split(","),_=1+e,te=Math.round(parseInt(T[0])*_),ae=Math.round(parseInt(T[1])*_),se=Math.round(parseInt(T[2])*_),ne=`rgba(${te},${ae},${se},1)`;y.attributes.fill.nodeValue=ne}})}if(d.id==="GelberSack"&&(d.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),d.id==="Blatt"&&(d.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),d.id==="Weihnachtsbaum"&&(d.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),d.id==="whatsapp"&&(d.attributes.style.value=`visibility: ${s===!0?"visible":"hidden"};`),d.id.indexOf("Abfuhrdatum")!==-1){const p={year:"2-digit",month:"2-digit",day:"2-digit"};o==="long"&&(p.weekday="long"),d.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,p),d.style.fontSize=`${n}px`,d.style.fontFamily=a,d.style.visibility=u===!0?"visible":"hidden"}d.id.indexOf("AnzahlTage")!==-1&&(d.innerHTML=g.ZP.t("vis_2_widgets_abfallkalender_dayCollection",{count:this.JsonObject.Resttage}),d.style.fontSize=n,d.style.fontFamily=a,d.style.visibility=ee===!0?"visible":"hidden")}),c===!0&&this.JsonObject.Blinken===!0){const d=[{opacity:0},{opacity:1}],p={duration:r*1e3,iterations:1/0};this.refTrashIcon.current.animate(d,p)}else this.refTrashIcon.current.getAnimations().map(d=>d.cancel())})}getJsonObject(t,e){return b(this,null,function*(){const a=`abfallkalender.${e}.WasteCalendar`;t!==""&&(yield this.props.socket.getForeignStates(a).then(n=>{if(!(a in n))return;const s=JSON.parse(n[a].val).filter(o=>o.AbfuhrartNr===t);this.JsonObject=typeof s[0]!="undefined"?s[0]:{},this.changeData({oid:a})}))})}updateWhatsappAndBlink(){return b(this,null,function*(){const t="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<t.length;s++)t[s]+="}",t[s]=JSON.parse(t[s].replaceAll(/'/g,'"'));const e=t.filter(s=>s.value===this.state.data.wastetype),a=e.length>0?parseInt(e[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:a===!0?"false":"true"}),a===!1&&this.changeData({whatsapplogo:!1});const n=e.length>0?parseInt(e[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:n===!0?"false":"true"}),n===!1&&this.changeData({blink:!1})})}static showWasteTypes(t,e,a){const n="selectwastetypes"in e&&e.selectwastetypes!==""?e.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<n.length;s++)n[s]+="}",n[s]=JSON.parse(n[s].replaceAll(/'/g,'"'));return e.selectwastetypes===""?l().createElement("div",null):l().createElement(D.Z,null,l().createElement(M.Z,{value:e[t.name],onChange:s=>{a({[t.name]:s.target.value})},input:l().createElement(R.Z,{name:"wastetypes"}),label:g.ZP.t("vis_2_widgets_abfallkalender_wastetype"),style:{fontSize:"12.8px"}},n.map(s=>l().createElement(E.Z,{key:s.value,value:s.value,style:{fontSize:"16px"}},s.title))))}getWasteTypes(t){return b(this,null,function*(){if(t==="")return"";const e=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(a=>{const n=[];return Object.keys(a).forEach(s=>{if(Object.keys(a).length===1||a[s]._id===`system.adapter.abfallkalender.${t}`)for(let o=0;o<a[s].native.wasteTypes.length;o++)a[s].native.wasteTypes[o].used===!0&&n.push({value:a[s].native.wasteTypes[o].value,title:a[s].native.wasteTypes[o].title,whatsapp:a[s].native.wasteTypes[o].whatsapp,blink:a[s].native.wasteTypes[o].blink})}),n}).then(a=>b(this,null,function*(){return this.state.editMode&&(yield this.arr2string(a).then(n=>{this.changeData({selectwastetypes:n})}),this.changeData({wastetypedisabled:a.length<2?"true":"false"})),a})).then(a=>{if(this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")){const n=a.length>0?a[0].value:"";return this.changeData({wastetype:n}),n}return a.filter(n=>n.value===this.state.data.wastetype).length>0?this.state.data.wastetype:(this.changeData({wastetype:""}),"")}).catch(a=>(console.log("ERROR !!!:"),console.log(a),""));return this.wastetypeLocal!==e&&(this.wastetypeLocal=e),e})}renderWidgetBody(t){return super.renderWidgetBody(t),l().createElement($.Z,{class:`"card-trash${t.id}"`,style:{width:"100%",height:"100%"}},l().createElement(L.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},l().createElement(J.r,{class:`"trashicon${t.id}"`,ref:this.refTrashIcon})))}}var H=(0,m.withStyles)(B)((0,m.withTheme)(C)),I=i(44914),F=i(48221),v=i(72659),N=i(76288),Z=i(17152),w=(f,t,e)=>new Promise((a,n)=>{var s=r=>{try{c(e.next(r))}catch(u){n(u)}},o=r=>{try{c(e.throw(r))}catch(u){n(u)}},c=r=>r.done?a(r.value):Promise.resolve(r.value).then(s,o);c((e=e.apply(f,t)).next())});const U=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class k extends(window.visRxWidget||S.VisRxWidget){constructor(t){super(t),this.arr2string=h.mR.bind(this),this.changeData=h.aw.bind(this),this.getInstances=h.il.bind(this),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.dayformatLocal=this.state.data.dayformat,this.oidChange=!1,this.wasteCalendar=[],this.refTable=l().createRef(),this.refTableBody=l().createRef(),this.refTableHeader=l().createRef()}static getWidgetInfo(){return{id:"tplAbfallTable",visSet:"abfallkalender",visName:x.i18n.t("vis_2_widgets_abfallkalender_widgetname_table"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(t,e,a)=>h.ZP.showInstances(t,e,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"dayformat",default:"short",label:"vis_2_widgets_abfallkalender_dayformat",type:"select",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(t,e,a)=>h.ZP.showFontfamily(t,e,a,["fontsizeheader","fontsizebody","fontsizemonth"])},{name:"showheader",default:!0,label:"vis_2_widgets_abfallkalender_showheader",type:"custom",component:(t,e,a)=>h.ZP.showCheckbox(t,e,a)},{name:"fontsizeheader",default:12,label:"vis_2_widgets_abfallkalender_fontsize_header",type:"slider",hidden:"data.showheader === false",min:6,max:24,step:1},{name:"fontsizemonth",default:10,label:"vis_2_widgets_abfallkalender_fontsize_month",type:"slider",min:6,max:24,step:1},{name:"fontsizebody",default:10,label:"vis_2_widgets_abfallkalender_fontsize_body",type:"slider",min:6,max:24,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/table.png"}}propertiesUpdate(){return w(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{dayformat:t,instancename:e}=this.state.data;(typeof e!="undefined"&&this.instancenameLocal!==e||this.oidChange===!0||this.dayformatLocal!==t)&&(this.instancenameLocal=e,this.dayformatLocal=t,yield this.getWasteCalendar(e),this.oidChange===!0&&(this.oidChange=!1))})}componentDidMount(){super.componentDidMount(),g.ZP.init(A.Z).then(()=>{g.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(t=>{this.getWasteCalendar(t).then(()=>{this.changeTableSize().then(()=>{this.initial=!1})})})}getWidgetInfo(){return k.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){this.changeTableSize()}changeTableSize(){return w(this,null,function*(){const t=this.refService.current.clientHeight;if(t!==0){const a=this.state.data.showheader===!1?0:parseInt(this.refTableHeader.current.offsetHeight),n=`${(t-2).toString()}px`,s=`${(t-a-10).toString()}px`;this.refTable.current.style.height=n,this.refTableBody.current.style.height=s}const e=this.refService.current.clientWidth;if(e!==0){const a=`${(e-2).toString()}px`;this.refTable.current.style.width=a,this.refTableBody.current.style.width=a,this.refTableHeader.current.style.width=a}})}onStateUpdated(t,e){this.oidChange=!0,this.propertiesUpdate()}getCalendarObject(t){return w(this,null,function*(){const e=`abfallkalender.${t}.WasteCalendar`;return yield this.props.socket.getForeignStates(e).then(n=>!(e in n)||typeof n[e].val=="undefined"?{}:(this.changeData({oid:e}),JSON.parse(n[e].val)))})}getWasteCalendar(t){return w(this,null,function*(){let e="",a="";this.wasteCalendar=[];const n=[],s=yield this.getCalendarObject(t);typeof s=="undefined"||Object.entries(s).length===0||(Object.entries(s).map(o=>{e!==o[1].Monatsname&&(n.push({col1span:3,col2span:0,col3span:0,col1:`${o[1].Monatsname} ${o[1].Jahr}`,col2:"",col3:""}),e=o[1].Monatsname),a!==o[1].Abfuhrdatum?(n.push({col1span:1,col2span:1,col3span:1,col1:`${this.state.data.dayformat==="short"?`${o[1].AbfuhrTagKurz}.`:o[1].AbfuhrTagLang}`,col2:`${o[1].Tag}.`,col3:o[1].Abfuhrart}),a=o[1].Abfuhrdatum):n.push({col1span:2,col2span:0,col3span:1,col1:"",col2:"",col3:o[1].Abfuhrart})}),this.wasteCalendar=[...n])})}renderWidgetBody(t){return super.renderWidgetBody(t),l().createElement("div",{ref:this.refTable,style:{overflow:"auto"}},this.state.data.showheader===!0&&l().createElement(I.Z,null,l().createElement(N.Z,{ref:this.refTableHeader},l().createElement(Z.Z,null,l().createElement(v.Z,{sx:{fontSize:this.state.data.fontsizeheader,fontFamily:this.state.data.fontfamily},colSpan:3,align:"left"},l().createElement("b",null,g.ZP.t("vis_2_widgets_abfallkalender_widgetname_table")))))),l().createElement("div",{ref:this.refTableBody,style:{overflow:"auto",height:"200px",width:"100%"}},l().createElement(I.Z,{size:"small"},l().createElement(F.Z,null,this.wasteCalendar.map((e,a)=>l().createElement(Z.Z,{key:a},e.col1span>0&&l().createElement(v.Z,{sx:{fontSize:e.col1span===3?this.state.data.fontsizemonth:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:e.col1span,align:"left"},e.col1),e.col2span>0&&l().createElement(v.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:e.col2span,align:"left"},e.col2),e.col3span>0&&l().createElement(v.Z,{sx:{fontSize:this.state.data.fontsizebody,fontFamily:this.state.data.fontfamily},colSpan:e.col3span,align:"left"},e.col3)))))))}}var V=(0,m.withStyles)(U)((0,m.withTheme)(k)),G=Object.defineProperty,K=(f,t,e)=>t in f?G(f,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[t]=e,Q=(f,t,e)=>(K(f,typeof t!="symbol"?t+"":t,e),e);const X=f=>{var t,e;return{app:{backgroundColor:(t=f==null?void 0:f.palette)==null?void 0:t.background.default,color:(e=f==null?void 0:f.palette)==null?void 0:e.text.primary,height:"100%",width:"100%",overflow:"auto",display:"flex"}}};class Y extends j.Z{constructor(t){super(t),Q(this,"onConnectionChanged",e=>{e&&this.socket.getSystemConfig().then(a=>this.setState({systemConfig:a}))}),x.i18n.extendTranslations(P),this.socket.registerConnectionHandler(this.onConnectionChanged)}renderWidget(){return l().createElement("div",{className:this.props.classes.app},l().createElement(H,{style:{width:560,height:530}}),l().createElement(V,null))}}var q=(0,m.withStyles)(X)(Y);(0,W.Z)(q)}}]);

//# sourceMappingURL=src_bootstrap_js-webpack_sharing_consume_default_mui_material_styles_mui_material_styles-webp-7f8b21.d6fed95f.chunk.js.map