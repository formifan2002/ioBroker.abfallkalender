"use strict";(self.webpackChunkiobroker_vis_widgets_abfallkalender=self.webpackChunkiobroker_vis_widgets_abfallkalender||[]).push([["src_bootstrap_js-webpack_sharing_consume_default_react-dom_client_react-dom_client"],{3215:function(Q,M,i){i.r(M);var T=i(96056),I=i(4819),r=i.n(I),E=i(83413),A=i(75606),b=i(58503),L={en:i(86443),de:i(19837),ru:i(50482),pt:i(65909),nl:i(43573),fr:i(86115),it:i(79399),es:i(55117),pl:i(28130),uk:i(17138),"zh-cn":i(58246)},p=i(82490),O=i(55973),Z=i(36315),j=i(42577),m=i(71386),v=i(69073),w=i(41381),k=i(67304),N=i(88411),W=i(10458),D=i(84543),u=(h,e,t)=>new Promise((a,n)=>{var s=c=>{try{l(t.next(c))}catch(y){n(y)}},d=c=>{try{l(t.throw(c))}catch(y){n(y)}},l=c=>c.done?a(c.value):Promise.resolve(c.value).then(s,d);l((t=t.apply(h,e)).next())});const B=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class S extends(window.visRxWidget||N.VisRxWidget){constructor(e){super(e),this.refTrashIcon=r().createRef(),this.initial=!0,this.instancenameLocal="",this.wastetypeLocal="",this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplAbfallkalender",visSet:"abfallkalender",visSetLabel:"vis_2_widgets_abfallkalender",visSetColor:"#63C149",visName:A.i18n.t("vis_2_widgets_abfallkalender_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,t,a)=>this.showInstances(e,t,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_abfallkalender_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(e,t,a)=>this.showWasteTypes(e,t,a)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_abfallkalender_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_abfallkalender_icontrash"},{value:"yellowbag",label:"vis_2_widgets_abfallkalender_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_abfallkalender_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_abfallkalender_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_abfallkalender_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_abfallkalender_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_abfallkalender_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(e,t,a)=>this.showCheckbox(e,t,a)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_abfallkalender_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(e,t,a)=>this.showCheckbox(e,t,a)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_abfallkalender_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_abfallkalender_showdate",type:"custom",component:(e,t,a)=>this.showCheckbox(e,t,a)},{name:"dateformat",default:"short",label:"vis_2_widgets_abfallkalender_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_abfallkalender_showdays",type:"custom",component:(e,t,a)=>this.showCheckbox(e,t,a)},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(e,t,a)=>this.showFontfamily(e,t,a)},{name:"fontsize",default:20,label:"vis_2_widgets_abfallkalender_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/abfallkalender.png"}}changeData(e){const{id:t,view:a,views:n,selectedWidgets:s}=this.props;(s!==null?s:[t]).forEach(l=>{Object.keys(e).forEach(c=>{n[a].widgets[l].data[c]=e[c],this.state.data[c]=e[c],this.state.rxData[c]=e[c]})})}propertiesUpdate(){return u(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:e,instancename:t}=this.state.data;let a=!0;typeof t!="undefined"&&this.instancenameLocal!==t&&(this.instancenameLocal=t,yield this.getWasteTypes(t),a=!1),(this.oidChange===!0||typeof e!="undefined"&&this.wastetypeLocal!==e)&&(this.wastetypeLocal=e,yield this.getJsonObject(e,this.instancenameLocal),yield this.updateWhatsappAndBlink(),a=!0,this.oidChange===!0&&(this.oidChange=!1)),a===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),p.ZP.init(D.Z).then(()=>{p.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(e=>{this.getWasteTypes(e).then(t=>{this.getJsonObject(t,e).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return S.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(e,t){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return u(this,null,function*(){const{trashcolor:e,trashcolorfactor:t,fontfamily:a,fontsize:n,whatsapplogo:s,dateformat:d,blink:l,blinkinterval:c,showdate:y,showdays:H}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(o=>{if(o.id==="Abfalltonne"){o.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let f="";o.childNodes.forEach(g=>{if(g.id==="tonne"&&(e===""?(this.state.data.trashcolor=g.attributes.fill.nodeValue,f=g.attributes.fill.nodeValue):(g.attributes.fill.nodeValue=this.state.data.trashcolor,f=this.state.data.trashcolor)),g.id==="tonne-innen"&&typeof f!="undefined"){const C=f.replace("rgba(","").replace(")","").split(","),x=1+t,G=Math.round(parseInt(C[0])*x),F=Math.round(parseInt(C[1])*x),V=Math.round(parseInt(C[2])*x),Y=`rgba(${G},${F},${V},1)`;g.attributes.fill.nodeValue=Y}})}if(o.id==="GelberSack"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),o.id==="Blatt"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),o.id==="Weihnachtsbaum"&&(o.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),o.id==="whatsapp"&&(o.attributes.style.value=`visibility: ${s===!0?"visible":"hidden"};`),o.id.indexOf("Abfuhrdatum")!==-1){const f={year:"2-digit",month:"2-digit",day:"2-digit"};d==="long"&&(f.weekday="long"),o.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,f),o.style.fontSize=`${n}px`,o.style.fontFamily=a,o.style.visibility=y===!0?"visible":"hidden"}o.id.indexOf("AnzahlTage")!==-1&&(o.innerHTML=p.ZP.t("vis_2_widgets_abfallkalender_dayCollection",{count:this.JsonObject.Resttage}),o.style.fontSize=n,o.style.fontFamily=a,o.style.visibility=H===!0?"visible":"hidden")}),l===!0){const o=[{opacity:0},{opacity:1}],f={duration:c*1e3,iterations:1/0};this.refTrashIcon.current.animate(o,f)}else this.refTrashIcon.current.getAnimations().map(o=>o.cancel())})}getJsonObject(e,t){return u(this,null,function*(){const a=`abfallkalender.${t}.CalendarDoubleQuotes`;e!==""&&(yield this.props.socket.getForeignStates(a).then(n=>{if(!(a in n))return;const s=JSON.parse(n[a].val).filter(d=>d.AbfuhrartNr===e);this.JsonObject=typeof s[0]!="undefined"?s[0]:{},this.changeData({oid:a})}))})}updateWhatsappAndBlink(){return u(this,null,function*(){const e="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<e.length;s++)e[s]+="}",e[s]=JSON.parse(e[s].replaceAll(/'/g,'"'));const t=e.filter(s=>s.value===this.state.data.wastetype),a=t.length>0?parseInt(t[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:a===!0?"false":"true"}),a===!1&&this.changeData({whatsapplogo:!1});const n=t.length>0?parseInt(t[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:n===!0?"false":"true"}),n===!1&&this.changeData({blink:!1})})}getInstances(){return u(this,null,function*(){let e=this.state.data.instancename;const t=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(a=>{const n=[];return Object.keys(a).forEach((s,d)=>{n.push({value:d,title:a[s]._id.replace("system.adapter.","")})}),n}).catch(a=>(console.log("ERROR !!!:"),console.log(a),[]));return this.state.editMode===!0&&(yield this.arr2string(t).then(a=>{this.changeData({selectinstances:a})}),this.changeData({instancenamehidden:t.length<2?"true":"false"})),this.initial===!0&&(!("instancename"in this.state.data)||this.state.data.instancename==="")&&(e=t.length>0?t[0].value:"",this.changeData({instancename:e})),this.instancenameLocal=e,e})}static showInstances(e,t,a){const n="selectinstances"in t&&t.selectinstances!==""?t.selectinstances.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<n.length;s++)n[s]+="}",n[s]=JSON.parse(n[s].replaceAll(/'/g,'"'));return t.selectinstances===""?r().createElement("div",null):r().createElement(m.Z,null,r().createElement(k.Z,{value:t[e.name],onChange:s=>{a({[e.name]:s.target.value})},input:r().createElement(v.Z,{name:"instances"}),label:p.ZP.t("vis_2_widgets_abfallkalender_instance"),style:{fontSize:"12.8px"}},n.map(s=>r().createElement(w.Z,{key:s.value,value:s.value,style:{fontSize:"16px"}},s.title))))}static showFontfamily(e,t,a){const n=new Set(["Arial","Arial Black","Bahnschrift","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Ebrima","Franklin Gothic Medium","Gabriola","Gadugi","Georgia","HoloLens MDL2 Assets","Impact","Ink Free","Javanese Text","Leelawadee UI","Lucida Console","Lucida Sans Unicode","Malgun Gothic","Marlett","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Mongolian Baiti","MS Gothic","MV Boli","Myanmar Text","Nirmala UI","Palatino Linotype","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Historic","Segoe UI Emoji","Segoe UI Symbol","SimSun","Sitka","Sylfaen","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Copperplate","Courier","Courier New","Didot","DIN Alternate","DIN Condensed","Futura","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","Impact","Lucida Grande","Luminari","Marker Felt","Menlo","Microsoft Sans Serif","Monaco","Noteworthy","Optima","Palatino","Papyrus","Phosphate","Rockwell","Savoye LET","SignPainter","Skia","Snell Roundhand","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Zapfino"].sort());document.fonts.ready;const s=new Set;for(const l of n.values())document.fonts.check(`${t.fontsize}px "${l}"`)&&s.add(l);const d=[];for(const l of s)d.push({title:l,value:l});return r().createElement(m.Z,null,r().createElement(k.Z,{value:t[e.name],onChange:l=>{a({[e.name]:l.target.value})},input:r().createElement(v.Z,{name:"fontfamily"}),label:p.ZP.t("vis_2_widgets_abfallkalender_fontfamily"),style:{fontSize:"12.8px"}},d.map(l=>r().createElement(w.Z,{key:l.value,value:l.value,style:{fontSize:"16px"}},l.title))))}static showWasteTypes(e,t,a){const n="selectwastetypes"in t&&t.selectwastetypes!==""?t.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let s=0;s<n.length;s++)n[s]+="}",n[s]=JSON.parse(n[s].replaceAll(/'/g,'"'));return t.selectwastetypes===""?r().createElement("div",null):r().createElement(m.Z,null,r().createElement(k.Z,{value:t[e.name],onChange:s=>{a({[e.name]:s.target.value})},input:r().createElement(v.Z,{name:"wastetypes"}),label:p.ZP.t("vis_2_widgets_abfallkalender_wastetype"),style:{fontSize:"12.8px"}},n.map(s=>r().createElement(w.Z,{key:s.value,value:s.value,style:{fontSize:"16px"}},s.title))))}static showCheckbox(e,t,a){return r().createElement(m.Z,null,r().createElement(Z.Z,{checked:t[e.name],onChange:n=>{a({[e.name]:n.target.checked})},color:"primary"}))}getWasteTypes(e){return u(this,null,function*(){if(e==="")return"";let t=this.state.data.wastetype;const a=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(n=>{const s=[];return Object.keys(n).forEach(d=>{if(Object.keys(n).length===1||n[d]._id===`system.adapter.${e}`)for(let l=0;l<n[d].native.wasteTypes.length;l++)n[d].native.wasteTypes[l].used===!0&&s.push({value:n[d].native.wasteTypes[l].value,title:n[d].native.wasteTypes[l].title,whatsapp:n[d].native.wasteTypes[l].whatsapp,blink:n[d].native.wasteTypes[l].blink})}),s}).catch(n=>(console.log("ERROR !!!:"),console.log(n),[]));return this.state.editMode&&(yield this.arr2string(a).then(n=>{this.changeData({selectwastetypes:n})}),this.changeData({wastetypedisabled:a.length<2?"true":"false"})),this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")&&(t=a.length>0?a[0].value:"",this.changeData({wastetype:t})),this.wastetypeLocal=t,t})}arr2string(e){return u(this,null,function*(){let t="";return e.map(a=>{t+="[",Object.keys(a).forEach((n,s)=>{s>0&&(t+=","),t+=`#${n}#: #${a[n].toString()}#`}),t+="]"}),t})}renderWidgetBody(e){return super.renderWidgetBody(e),r().createElement(j.Z,{class:`"card-trash${e.id}"`,style:{width:"100%",height:"100%"}},r().createElement(O.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},r().createElement(W.r,{class:`"trashicon${e.id}"`,ref:this.refTrashIcon})))}}var P=(0,b.withStyles)(B)((0,b.withTheme)(S)),_=Object.defineProperty,R=(h,e,t)=>e in h?_(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t,$=(h,e,t)=>(R(h,typeof e!="symbol"?e+"":e,t),t);const J=h=>{var e,t;return{app:{backgroundColor:(e=h==null?void 0:h.palette)==null?void 0:e.background.default,color:(t=h==null?void 0:h.palette)==null?void 0:t.text.primary,height:"100%",width:"100%",overflow:"auto",display:"flex"}}};class U extends E.Z{constructor(e){super(e),$(this,"onConnectionChanged",t=>{t&&this.socket.getSystemConfig().then(a=>this.setState({systemConfig:a}))}),A.i18n.extendTranslations(L),this.socket.registerConnectionHandler(this.onConnectionChanged)}renderWidget(){return r().createElement("div",{className:this.props.classes.app},r().createElement(P,{style:{width:560,height:530}}))}}var z=(0,b.withStyles)(J)(U);(0,T.Z)(z)}}]);

//# sourceMappingURL=src_bootstrap_js-webpack_sharing_consume_default_react-dom_client_react-dom_client.1ce30540.chunk.js.map