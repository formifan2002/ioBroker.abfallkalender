"use strict";(self.webpackChunkiobroker_vis_widgets_abfallkalender=self.webpackChunkiobroker_vis_widgets_abfallkalender||[]).push([["src_AbfallIcon_jsx"],{96175:function(k,_,s){s.r(_);var g=s(4819),d=s.n(g),y=s(82490),A=s(75606),T=s.n(A),C=s(84854),w=s(35069),E=s(65267),M=s(26750),P=s(7784),O=s(68723),m=s(58503),L=s.n(m),R=s(88411),W=s.n(R),D=s(10458),I=s(84543),r=s(84998),p=(h,e,a)=>new Promise((t,i)=>{var n=f=>{try{u(a.next(f))}catch(x){i(x)}},o=f=>{try{u(a.throw(f))}catch(x){i(x)}},u=f=>f.done?t(f.value):Promise.resolve(f.value).then(n,o);u((a=a.apply(h,e)).next())});const Z=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class c extends(window.visRxWidget||R.VisRxWidget){constructor(e){super(e),this.changeData=r.aw.bind(this),this.arr2string=r.mR.bind(this),this.getInstances=r.il.bind(this),this.refTrashIcon=d().createRef(),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.wastetypeLocal=this.state.data.wastetype,this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplAbfallIcon",visSet:"abfallkalender",visSetLabel:"vis_2_widgets_abfallkalender",visSetColor:"#63C149",visName:A.i18n.t("vis_2_widgets_abfallkalender_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,a,t)=>r.ZP.showInstances(e,a,t)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_abfallkalender_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(e,a,t)=>this.showWasteTypes(e,a,t)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_abfallkalender_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_abfallkalender_icontrash"},{value:"yellowbag",label:"vis_2_widgets_abfallkalender_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_abfallkalender_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_abfallkalender_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_abfallkalender_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_abfallkalender_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_abfallkalender_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(e,a,t)=>r.ZP.showCheckbox(e,a,t)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_abfallkalender_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(e,a,t)=>r.ZP.showCheckbox(e,a,t)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_abfallkalender_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_abfallkalender_showdate",type:"custom",component:(e,a,t)=>r.ZP.showCheckbox(e,a,t)},{name:"dateformat",default:"short",label:"vis_2_widgets_abfallkalender_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_abfallkalender_showdays",type:"custom",component:(e,a,t)=>r.ZP.showCheckbox(e,a,t)},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(e,a,t)=>r.ZP.showFontfamily(e,a,t,["fontsize"])},{name:"fontsize",default:20,label:"vis_2_widgets_abfallkalender_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/trash.png"}}propertiesUpdate(){return p(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:e,instancename:a}=this.state.data;let t=!0;typeof a!="undefined"&&this.instancenameLocal!==a&&(this.instancenameLocal=a,yield this.getWasteTypes(a),t=!1),(this.oidChange===!0||typeof e!="undefined"&&this.wastetypeLocal!==e)&&(this.wastetypeLocal=e,yield this.getJsonObject(e,this.instancenameLocal),yield this.updateWhatsappAndBlink(),t=!0,this.oidChange===!0&&(this.oidChange=!1)),t===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),y.ZP.init(I.Z).then(()=>{y.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(e=>{this.getWasteTypes(e).then(a=>{this.getJsonObject(a,e).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return c.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(e,a){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return p(this,null,function*(){const{trashcolor:e,trashcolorfactor:a,fontfamily:t,fontsize:i,whatsapplogo:n,dateformat:o,blink:u,blinkinterval:f,showdate:x,showdays:B}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(l=>{if(l.id==="Abfalltonne"){l.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let v="";l.childNodes.forEach(b=>{if(b.id==="tonne"&&(e===""?(this.state.data.trashcolor=b.attributes.fill.nodeValue,v=b.attributes.fill.nodeValue):(b.attributes.fill.nodeValue=this.state.data.trashcolor,v=this.state.data.trashcolor)),b.id==="tonne-innen"&&typeof v!="undefined"){const U=v.replace("rgba(","").replace(")","").split(","),j=1+a,S=Math.round(parseInt(U[0])*j),K=Math.round(parseInt(U[1])*j),J=Math.round(parseInt(U[2])*j),N=`rgba(${S},${K},${J},1)`;b.attributes.fill.nodeValue=N}})}if(l.id==="GelberSack"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),l.id==="Blatt"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),l.id==="Weihnachtsbaum"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),l.id==="whatsapp"&&(l.attributes.style.value=`visibility: ${n===!0?"visible":"hidden"};`),l.id.indexOf("Abfuhrdatum")!==-1){const v={year:"2-digit",month:"2-digit",day:"2-digit"};o==="long"&&(v.weekday="long"),l.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,v),l.style.fontSize=`${i}px`,l.style.fontFamily=t,l.style.visibility=x===!0?"visible":"hidden"}l.id.indexOf("AnzahlTage")!==-1&&(l.innerHTML=y.ZP.t("vis_2_widgets_abfallkalender_dayCollection",{count:this.JsonObject.Resttage}),l.style.fontSize=i,l.style.fontFamily=t,l.style.visibility=B===!0?"visible":"hidden")}),u===!0&&this.JsonObject.Blinken===!0){const l=[{opacity:0},{opacity:1}],v={duration:f*1e3,iterations:1/0};this.refTrashIcon.current.animate(l,v)}else this.refTrashIcon.current.getAnimations().map(l=>l.cancel())})}getJsonObject(e,a){return p(this,null,function*(){const t=`abfallkalender.${a}.WasteCalendar`;e!==""&&(yield this.props.socket.getForeignStates(t).then(i=>{if(!(t in i))return;const n=JSON.parse(i[t].val).filter(o=>o.AbfuhrartNr===e);this.JsonObject=typeof n[0]!="undefined"?n[0]:{},this.changeData({oid:t})}))})}updateWhatsappAndBlink(){return p(this,null,function*(){const e="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<e.length;n++)e[n]+="}",e[n]=JSON.parse(e[n].replaceAll(/'/g,'"'));const a=e.filter(n=>n.value===this.state.data.wastetype),t=a.length>0?parseInt(a[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:t===!0?"false":"true"}),t===!1&&this.changeData({whatsapplogo:!1});const i=a.length>0?parseInt(a[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:i===!0?"false":"true"}),i===!1&&this.changeData({blink:!1})})}static showWasteTypes(e,a,t){const i="selectwastetypes"in a&&a.selectwastetypes!==""?a.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<i.length;n++)i[n]+="}",i[n]=JSON.parse(i[n].replaceAll(/'/g,'"'));return a.selectwastetypes===""?d().createElement("div",null):d().createElement(E.Z,null,d().createElement(O.Z,{value:a[e.name],onChange:n=>{t({[e.name]:n.target.value})},input:d().createElement(M.Z,{name:"wastetypes"}),label:y.ZP.t("vis_2_widgets_abfallkalender_wastetype"),style:{fontSize:"12.8px"}},i.map(n=>d().createElement(P.Z,{key:n.value,value:n.value,style:{fontSize:"16px"}},n.title))))}getWasteTypes(e){return p(this,null,function*(){if(e==="")return"";const a=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(t=>{const i=[];return Object.keys(t).forEach(n=>{if(Object.keys(t).length===1||t[n]._id===`system.adapter.abfallkalender.${e}`)for(let o=0;o<t[n].native.wasteTypes.length;o++)t[n].native.wasteTypes[o].used===!0&&i.push({value:t[n].native.wasteTypes[o].value,title:t[n].native.wasteTypes[o].title,whatsapp:t[n].native.wasteTypes[o].whatsapp,blink:t[n].native.wasteTypes[o].blink})}),i}).then(t=>p(this,null,function*(){return this.state.editMode&&(yield this.arr2string(t).then(i=>{this.changeData({selectwastetypes:i})}),this.changeData({wastetypedisabled:t.length<2?"true":"false"})),t})).then(t=>{if(this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")){const i=t.length>0?t[0].value:"";return this.changeData({wastetype:i}),i}return t.filter(i=>i.value===this.state.data.wastetype).length>0?this.state.data.wastetype:(this.changeData({wastetype:""}),"")}).catch(t=>(console.log("ERROR !!!:"),console.log(t),""));return this.wastetypeLocal!==a&&(this.wastetypeLocal=a),a})}renderWidgetBody(e){return super.renderWidgetBody(e),d().createElement(w.Z,{class:`"card-trash${e.id}"`,style:{width:"100%",height:"100%"}},d().createElement(C.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},d().createElement(D.r,{class:`"trashicon${e.id}"`,ref:this.refTrashIcon})))}}_.default=(0,m.withStyles)(Z)((0,m.withTheme)(c))},84854:function(k,_,s){s.d(_,{Z:function(){return Z}});var g=s(87462),d=s(63366),y=s(4819),A=s(15854),T=s(64983),C=s.n(T),w=s(13957),E=s(82500),M=s(89857),P=s(67402),O=s(59690);function m(c){return(0,O.Z)("MuiCardContent",c)}const L=(0,P.Z)("MuiCardContent",["root"]);var R=null,W=s(67557);const D=["className","component"],I=c=>{const{classes:h}=c,e={root:["root"]};return(0,w.Z)(e,m,h)},r=(0,E.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(c,h)=>h.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}}));var Z=y.forwardRef(function(h,e){const a=(0,M.Z)({props:h,name:"MuiCardContent"}),{className:t,component:i="div"}=a,n=(0,d.Z)(a,D),o=(0,g.Z)({},a,{component:i}),u=I(o);return(0,W.jsx)(r,(0,g.Z)({as:i,className:C()(u.root,t),ownerState:o,ref:e},n))})},35069:function(k,_,s){s.d(_,{Z:function(){return c}});var g=s(87462),d=s(63366),y=s(4819),A=s(15854),T=s(64983),C=s.n(T),w=s(13957),E=s(82500),M=s(89857),P=s(33172),O=s(67402),m=s(59690);function L(h){return(0,m.Z)("MuiCard",h)}const R=(0,O.Z)("MuiCard",["root"]);var W=null,D=s(67557);const I=["className","raised"],r=h=>{const{classes:e}=h,a={root:["root"]};return(0,w.Z)(a,L,e)},p=(0,E.ZP)(P.Z,{name:"MuiCard",slot:"Root",overridesResolver:(h,e)=>e.root})(()=>({overflow:"hidden"}));var c=y.forwardRef(function(e,a){const t=(0,M.Z)({props:e,name:"MuiCard"}),{className:i,raised:n=!1}=t,o=(0,d.Z)(t,I),u=(0,g.Z)({},t,{raised:n}),f=r(u);return(0,D.jsx)(p,(0,g.Z)({className:C()(f.root,i),elevation:n?8:void 0,ref:a,ownerState:u},o))})}}]);

//# sourceMappingURL=src_AbfallIcon_jsx.4543e69c.chunk.js.map