"use strict";(self.webpackChunkiobroker_vis_widgets_abfallkalender=self.webpackChunkiobroker_vis_widgets_abfallkalender||[]).push([["src_AbfallIcon_jsx"],{96175:function(W,c,e){e.r(c);var f=e(4819),o=e.n(f),_=e(82490),y=e(75606),m=e.n(y),K=e(55973),D=e(42577),C=e(71386),b=e(69073),I=e(41381),w=e(67304),g=e(58503),U=e.n(g),P=e(88411),B=e.n(P),A=e(10458),T=e(84543),d=e(84998),r=(M,a,s)=>new Promise((t,i)=>{var n=E=>{try{R(s.next(E))}catch(L){i(L)}},h=E=>{try{R(s.throw(E))}catch(L){i(L)}},R=E=>E.done?t(E.value):Promise.resolve(E.value).then(n,h);R((s=s.apply(M,a)).next())});const u=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class p extends(window.visRxWidget||P.VisRxWidget){constructor(a){super(a),this.changeData=d.aw.bind(this),this.arr2string=d.mR.bind(this),this.getInstances=d.il.bind(this),this.refTrashIcon=o().createRef(),this.initial=!0,this.instancenameLocal=this.state.data.instancename,this.wastetypeLocal=this.state.data.wastetype,this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplAbfallIcon",visSet:"abfallkalender",visSetLabel:"vis_2_widgets_abfallkalender",visSetColor:"#63C149",visName:y.i18n.t("vis_2_widgets_abfallkalender_widgetname_icon"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(a,s,t)=>d.ZP.showInstances(a,s,t)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_abfallkalender_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(a,s,t)=>this.showWasteTypes(a,s,t)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"icon",default:"trash",label:"vis_2_widgets_abfallkalender_icon",type:"select",options:[{value:"trash",label:"vis_2_widgets_abfallkalender_icontrash"},{value:"yellowbag",label:"vis_2_widgets_abfallkalender_iconyellowbag"},{value:"christmastree",label:"vis_2_widgets_abfallkalender_iconchristmastree"},{value:"leaf",label:"vis_2_widgets_abfallkalender_iconleaf"}]},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_abfallkalender_trashcolor",type:"color",hidden:'data.icon !== "trash"'},{name:"trashcolorfactor",hidden:'data.icon !== "trash"',default:-.3,label:"vis_2_widgets_abfallkalender_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_abfallkalender_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(a,s,t)=>d.ZP.showCheckbox(a,s,t)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_abfallkalender_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(a,s,t)=>d.ZP.showCheckbox(a,s,t)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_abfallkalender_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"showdate",default:!0,label:"vis_2_widgets_abfallkalender_showdate",type:"custom",component:(a,s,t)=>d.ZP.showCheckbox(a,s,t)},{name:"dateformat",default:"short",label:"vis_2_widgets_abfallkalender_dateformat",type:"select",hidden:"data.showdate === false",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"showdays",default:!0,label:"vis_2_widgets_abfallkalender_showdays",type:"custom",component:(a,s,t)=>d.ZP.showCheckbox(a,s,t)},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",hidden:"data.showdate === false && data.showdays === false",component:(a,s,t)=>d.ZP.showFontfamily(a,s,t,["fontsize"])},{name:"fontsize",default:20,label:"vis_2_widgets_abfallkalender_fontsize",type:"slider",hidden:"data.showdate === false && data.showdays === false",min:6,max:45,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/trash.png"}}propertiesUpdate(){return r(this,null,function*(){if(this.initial===!0&&this.oidChange!==!0)return;const{wastetype:a,instancename:s}=this.state.data;let t=!0;typeof s!="undefined"&&this.instancenameLocal!==s&&(this.instancenameLocal=s,yield this.getWasteTypes(s),t=!1),(this.oidChange===!0||typeof a!="undefined"&&this.wastetypeLocal!==a)&&(this.wastetypeLocal=a,yield this.getJsonObject(a,this.instancenameLocal),yield this.updateWhatsappAndBlink(),t=!0,this.oidChange===!0&&(this.oidChange=!1)),t===!0&&(yield this.renderIcon())})}componentDidMount(){super.componentDidMount(),_.ZP.init(T.Z).then(()=>{_.ZP.changeLanguage(this.props.systemConfig.common.language)}),this.getInstances().then(a=>{this.getWasteTypes(a).then(s=>{this.getJsonObject(s,a).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderIcon().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return p.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(a,s){this.oidChange=!0,this.propertiesUpdate()}renderIcon(){return r(this,null,function*(){const{trashcolor:a,trashcolorfactor:s,fontfamily:t,fontsize:i,whatsapplogo:n,dateformat:h,blink:R,blinkinterval:E,showdate:L,showdays:k}=this.state.data;if(this.refTrashIcon.current.childNodes.forEach(l=>{if(l.id==="Abfalltonne"){l.attributes.style.value=`visibility: ${this.state.data.icon==="trash"?"visible":"hidden"};`;let v="";l.childNodes.forEach(O=>{if(O.id==="tonne"&&(a===""?(this.state.data.trashcolor=O.attributes.fill.nodeValue,v=O.attributes.fill.nodeValue):(O.attributes.fill.nodeValue=this.state.data.trashcolor,v=this.state.data.trashcolor)),O.id==="tonne-innen"&&typeof v!="undefined"){const x=v.replace("rgba(","").replace(")","").split(","),Z=1+s,S=Math.round(parseInt(x[0])*Z),j=Math.round(parseInt(x[1])*Z),N=Math.round(parseInt(x[2])*Z),J=`rgba(${S},${j},${N},1)`;O.attributes.fill.nodeValue=J}})}if(l.id==="GelberSack"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="yellowbag"?"visible":"hidden"};`),l.id==="Blatt"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="leaf"?"visible":"hidden"};`),l.id==="Weihnachtsbaum"&&(l.attributes.style.value=`visibility: ${this.state.data.icon==="christmastree"?"visible":"hidden"};`),l.id==="whatsapp"&&(l.attributes.style.value=`visibility: ${n===!0?"visible":"hidden"};`),l.id.indexOf("Abfuhrdatum")!==-1){const v={year:"2-digit",month:"2-digit",day:"2-digit"};h==="long"&&(v.weekday="long"),l.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,v),l.style.fontSize=`${i}px`,l.style.fontFamily=t,l.style.visibility=L===!0?"visible":"hidden"}l.id.indexOf("AnzahlTage")!==-1&&(l.innerHTML=_.ZP.t("vis_2_widgets_abfallkalender_dayCollection",{count:this.JsonObject.Resttage}),l.style.fontSize=i,l.style.fontFamily=t,l.style.visibility=k===!0?"visible":"hidden")}),R===!0&&this.JsonObject.Blinken===!0){const l=[{opacity:0},{opacity:1}],v={duration:E*1e3,iterations:1/0};this.refTrashIcon.current.animate(l,v)}else this.refTrashIcon.current.getAnimations().map(l=>l.cancel())})}getJsonObject(a,s){return r(this,null,function*(){const t=`abfallkalender.${s}.CalendarDoubleQuotes`;a!==""&&(yield this.props.socket.getForeignStates(t).then(i=>{if(!(t in i))return;const n=JSON.parse(i[t].val).filter(h=>h.AbfuhrartNr===a);this.JsonObject=typeof n[0]!="undefined"?n[0]:{},this.changeData({oid:t})}))})}updateWhatsappAndBlink(){return r(this,null,function*(){const a="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<a.length;n++)a[n]+="}",a[n]=JSON.parse(a[n].replaceAll(/'/g,'"'));const s=a.filter(n=>n.value===this.state.data.wastetype),t=s.length>0?parseInt(s[0].whatsapp)>-1:!1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:t===!0?"false":"true"}),t===!1&&this.changeData({whatsapplogo:!1});const i=s.length>0?parseInt(s[0].blink)>-1:!1;this.state.editMode===!0&&this.changeData({blinkhidden:i===!0?"false":"true"}),i===!1&&this.changeData({blink:!1})})}static showWasteTypes(a,s,t){const i="selectwastetypes"in s&&s.selectwastetypes!==""?s.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<i.length;n++)i[n]+="}",i[n]=JSON.parse(i[n].replaceAll(/'/g,'"'));return s.selectwastetypes===""?o().createElement("div",null):o().createElement(C.Z,null,o().createElement(w.Z,{value:s[a.name],onChange:n=>{t({[a.name]:n.target.value})},input:o().createElement(b.Z,{name:"wastetypes"}),label:_.ZP.t("vis_2_widgets_abfallkalender_wastetype"),style:{fontSize:"12.8px"}},i.map(n=>o().createElement(I.Z,{key:n.value,value:n.value,style:{fontSize:"16px"}},n.title))))}getWasteTypes(a){return r(this,null,function*(){if(a==="")return"";const s=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(t=>{const i=[];return Object.keys(t).forEach(n=>{if(Object.keys(t).length===1||t[n]._id===`system.adapter.abfallkalender.${a}`)for(let h=0;h<t[n].native.wasteTypes.length;h++)t[n].native.wasteTypes[h].used===!0&&i.push({value:t[n].native.wasteTypes[h].value,title:t[n].native.wasteTypes[h].title,whatsapp:t[n].native.wasteTypes[h].whatsapp,blink:t[n].native.wasteTypes[h].blink})}),i}).then(t=>r(this,null,function*(){return this.state.editMode&&(yield this.arr2string(t).then(i=>{this.changeData({selectwastetypes:i})}),this.changeData({wastetypedisabled:t.length<2?"true":"false"})),t})).then(t=>{if(this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")){const i=t.length>0?t[0].value:"";return this.changeData({wastetype:i}),i}return t.filter(i=>i.value===this.state.data.wastetype).length>0?this.state.data.wastetype:(this.changeData({wastetype:""}),"")}).catch(t=>(console.log("ERROR !!!:"),console.log(t),""));return this.wastetypeLocal!==s&&(this.wastetypeLocal=s),s})}renderWidgetBody(a){return super.renderWidgetBody(a),o().createElement(D.Z,{class:`"card-trash${a.id}"`,style:{width:"100%",height:"100%"}},o().createElement(K.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},o().createElement(A.r,{class:`"trashicon${a.id}"`,ref:this.refTrashIcon})))}}c.default=(0,g.withStyles)(u)((0,g.withTheme)(p))},55973:function(W,c,e){var f=e(87462),o=e(63366),_=e(4819),y=e.n(_),m=e(15854),K=e.n(m),D=e(64983),C=e.n(D),b=e(13957),I=e(82500),w=e(89857),g=e(4502),U=e(67557);const P=["className","component"],B=d=>{const{classes:r}=d,u={root:["root"]};return(0,b.Z)(u,g.N,r)},A=(0,I.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(d,r)=>r.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),T=_.forwardRef(function(r,u){const p=(0,w.Z)({props:r,name:"MuiCardContent"}),{className:M,component:a="div"}=p,s=(0,o.Z)(p,P),t=(0,f.Z)({},p,{component:a}),i=B(t);return(0,U.jsx)(A,(0,f.Z)({as:a,className:C()(i.root,M),ownerState:t,ref:u},s))});c.Z=T},4502:function(W,c,e){e.d(c,{N:function(){return _}});var f=e(67402),o=e(85111);function _(m){return(0,o.Z)("MuiCardContent",m)}const y=(0,f.Z)("MuiCardContent",["root"]);c.Z=y},42577:function(W,c,e){var f=e(87462),o=e(63366),_=e(4819),y=e.n(_),m=e(15854),K=e.n(m),D=e(64983),C=e.n(D),b=e(13957),I=e(82500),w=e(89857),g=e(30464),U=e(53478),P=e(67557);const B=["className","raised"],A=r=>{const{classes:u}=r,p={root:["root"]};return(0,b.Z)(p,U.y,u)},T=(0,I.ZP)(g.Z,{name:"MuiCard",slot:"Root",overridesResolver:(r,u)=>u.root})(()=>({overflow:"hidden"})),d=_.forwardRef(function(u,p){const M=(0,w.Z)({props:u,name:"MuiCard"}),{className:a,raised:s=!1}=M,t=(0,o.Z)(M,B),i=(0,f.Z)({},M,{raised:s}),n=A(i);return(0,P.jsx)(T,(0,f.Z)({className:C()(n.root,a),elevation:s?8:void 0,ref:p,ownerState:i},t))});c.Z=d},53478:function(W,c,e){e.d(c,{y:function(){return _}});var f=e(67402),o=e(85111);function _(m){return(0,o.Z)("MuiCard",m)}const y=(0,f.Z)("MuiCard",["root"]);c.Z=y}}]);

//# sourceMappingURL=src_AbfallIcon_jsx.84429f70.chunk.js.map