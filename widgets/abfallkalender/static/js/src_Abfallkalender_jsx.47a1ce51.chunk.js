"use strict";(self.webpackChunkiobroker_vis_widgets_abfallkalender=self.webpackChunkiobroker_vis_widgets_abfallkalender||[]).push([["src_Abfallkalender_jsx"],{31984:function(L,_,l){l.r(_);var h=l(4819),i=l.n(h),u=l(55973),g=l(36315),m=l(42577),C=l(71386),O=l(69073),D=l(41381),P=l(67304),b=l(58503),R=l.n(b),E=l(75606),B=l.n(E),A=l(88411),W=l.n(A),I=l(30272),f=(p,e,t)=>new Promise((a,s)=>{var n=y=>{try{r(t.next(y))}catch(v){s(v)}},o=y=>{try{r(t.throw(y))}catch(v){s(v)}},r=y=>y.done?a(y.value):Promise.resolve(y.value).then(n,o);r((t=t.apply(p,e)).next())});const T=()=>({root:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"}});class c extends(window.visRxWidget||A.VisRxWidget){constructor(e){super(e),this.refTrashIcon=i().createRef(),this.initial=!0,this.instancenameLocal="",this.wastetypeLocal="",this.JsonObject={},this.oidChange=!1}static getWidgetInfo(){return{id:"tplAbfallkalender",visSet:"abfallkalender",visSetLabel:"vis_2_widgets_abfallkalender",visSetColor:"#63C149",visName:E.I18n.t("vis_2_widgets_abfallkalender"),visAttrs:[{name:"common",label:"vis_2_widgets_abfallkalender_common",fields:[{name:"instancename",label:"vis_2_widgets_abfallkalender_instance",type:"custom",hidden:'data.instancenamehidden === "true"',component:(e,t,a)=>this.showInstances(e,t,a)},{name:"instancenamehidden",type:"text",hidden:!0,default:"false"},{name:"selectinstances",label:"selectinstances",type:"text",hidden:!0,default:""},{name:"wastetype",label:"vis_2_widgets_abfallkalender_wastetype",type:"custom",disabled:'data.wastetypedisabled === "true"',component:(e,t,a)=>this.showWasteTypes(e,t,a)},{name:"wastetypedisabled",type:"text",hidden:!0,default:"false"},{name:"selectwastetypes",label:"selectwastetypes",type:"text",hidden:!0,default:""},{name:"trashcolor",default:"rgba(40,30,88,1)",label:"vis_2_widgets_abfallkalender_trashcolor",type:"color"},{name:"trashcolorfactor",default:-.3,label:"vis_2_widgets_abfallkalender_trashcolor_factor",type:"slider",min:-1,max:1,step:.1},{name:"whatsapplogo",default:!0,label:"vis_2_widgets_abfallkalender_whatsapplogo",type:"custom",hidden:'data.whatsapplogohidden === "true"',component:(e,t,a)=>this.showWhatsapp(e,t,a)},{name:"whatsapplogohidden",type:"text",hidden:!0,default:"false"},{name:"blink",default:!0,label:"vis_2_widgets_abfallkalender_blink",type:"custom",hidden:'data.blinkhidden === "true"',component:(e,t,a)=>this.showBlink(e,t,a)},{name:"blinkhidden",type:"text",hidden:!0,default:"false"},{name:"blinkinterval",default:3,label:"vis_2_widgets_abfallkalender_blinkinterval",type:"slider",hidden:'data.blink === false || data.blinkhidden === "true"',min:1,max:15,step:1},{name:"dateformat",default:"short",label:"vis_2_widgets_abfallkalender_dateformat",type:"select",options:[{value:"short",label:"vis_2_widgets_abfallkalender_dateformat_short"},{value:"long",label:"vis_2_widgets_abfallkalender_dateformat_long"}]},{name:"fontfamily",label:"vis_2_widgets_abfallkalender_fontfamily",default:"Arial",type:"custom",component:(e,t,a)=>this.showFontfamily(e,t,a)},{name:"fontsize",default:12,label:"vis_2_widgets_abfallkalender_fontsize",type:"slider",min:6,max:48,step:1},{name:"oid",label:"vis_2_widgets_abfallkalender_oid",type:"id",noInit:!0,hidden:!0}]}],visPrev:"widgets/abfallkalender/img/abfallkalender.png"}}changeData(e){const{view:t,views:a,selectedWidgets:s}=this.props;s.forEach(n=>{Object.keys(e).forEach(o=>{a[t].widgets[n].data[o]=e[o],this.state.data[o]=e[o],this.state.rxData[o]=e[o]})})}propertiesUpdate(){return f(this,null,function*(){if(this.initial)return;const{wastetype:e,instancename:t}=this.state.data;let a=!0;typeof t!="undefined"&&this.instancenameLocal!==t&&(this.instancenameLocal=t,yield this.getWasteTypes(t),a=!1),(this.oidChange===!0||typeof e!="undefined"&&this.wastetypeLocal!==e)&&(this.wastetypeLocal=e,yield this.getJsonObject(e,this.instancenameLocal),yield this.updateWhatsappAndBlink(),a=!0,this.oidChange===!0&&(this.oidChange=!1)),a===!0&&(yield this.renderTrash())})}componentDidMount(){super.componentDidMount(),this.getInstances().then(e=>{this.getWasteTypes(e).then(t=>{this.getJsonObject(t,e).then(()=>{this.updateWhatsappAndBlink().then(()=>{this.renderTrash().then(()=>{this.initial=!1})})})})})}getWidgetInfo(){return c.getWidgetInfo()}onRxDataChanged(){this.propertiesUpdate()}onRxStyleChanged(){}onStateUpdated(e,t){this.oidChange=!0,this.propertiesUpdate()}renderTrash(){return f(this,null,function*(){const{blink:e,blinkinterval:t,fontfamily:a,fontsize:s,whatsapplogo:n,dateformat:o,trashcolor:r,trashcolorfactor:y}=this.state.data;let v="";if(this.refTrashIcon.current.childNodes.forEach(d=>{if(d.id==="tonne"&&(r===""?(this.state.data.trashcolor=d.attributes.fill.nodeValue,v=d.attributes.fill.nodeValue):(d.attributes.fill.nodeValue=this.state.data.trashcolor,v=this.state.data.trashcolor)),d.id==="tonne-innen"&&typeof v!="undefined"){const M=v.replace("rgba(","").replace(")","").split(","),U=1+y,S=Math.round(parseInt(M[0])*U),w=Math.round(parseInt(M[1])*U),K=Math.round(parseInt(M[2])*U),k=`rgba(${S},${w},${K},1)`;d.attributes.fill.nodeValue=k}if(d.id==="whatsapp"&&(d.attributes.style.value=`visibility: ${n===!0?"visible":"hidden"};`),d.id.indexOf("Abfuhrdatum")!==-1){const M={year:"2-digit",month:"2-digit",day:"2-digit"};o==="long"&&(M.weekday="long"),d.innerHTML=new Date(this.JsonObject.AbfuhrtagJson).toLocaleDateString(this.props.lang,M),d.style.fontSize=`${s}px`,d.style.fontFamily=a}d.id.indexOf("AnzahlTage")!==-1&&(d.innerHTML=this.JsonObject.Resttage.toString(),d.style.fontSize=s,d.style.fontFamily=a)}),e===!0){const d=[{opacity:0},{opacity:1}],M={duration:t*1e3,iterations:1/0};this.refTrashIcon.current.animate(d,M)}else this.refTrashIcon.current.getAnimations().map(d=>d.cancel());return!0})}getJsonObject(e,t){return f(this,null,function*(){const a=`abfallkalender.${t}.CalendarDoubleQuotes`;e!==""&&(yield this.props.socket.getForeignStates(a).then(s=>{if(!(a in s))return;const n=JSON.parse(s[a].val).filter(o=>o.AbfuhrartNr===e);this.JsonObject=typeof n[0]!="undefined"?n[0]:{},this.changeData({oid:a})}))})}updateWhatsappAndBlink(){return f(this,null,function*(){const e="selectwastetypes"in this.state.data&&this.state.data.selectwastetypes!==""?this.state.data.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<e.length;n++)e[n]+="}",e[n]=JSON.parse(e[n].replaceAll(/'/g,'"'));const t=e.filter(n=>n.value===this.state.data.wastetype),a=parseInt(t.whatsapp)>-1;this.state.editMode===!0&&this.changeData({whatsapplogohidden:a===!0?"false":"true"}),a===!1&&this.changeData({whatsapplogo:!1});const s=parseInt(t.blink)>-1;this.state.editMode===!0&&this.changeData({blinkhidden:s===!0?"false":"true"}),s===!1&&this.changeData({blink:!1})})}getInstances(){return f(this,null,function*(){let e=this.state.data.instancename;const t=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(a=>{const s=[];return Object.keys(a).forEach((n,o)=>{s.push({value:o,title:a[n]._id.replace("system.adapter.","")})}),s}).catch(a=>(console.log("ERROR !!!:"),console.log(a),[]));return this.state.editMode===!0&&(yield this.arr2string(t).then(a=>{this.changeData({selectinstances:a})}),this.changeData({instancenamehidden:t.length<2?"true":"false"})),this.initial===!0&&(!("instancename"in this.state.data)||this.state.data.instancename==="")&&(e=t.length>0?t[0].value:"",this.changeData({instancename:e})),this.instancenameLocal=e,e})}static showInstances(e,t,a){const s="selectinstances"in t&&t.selectinstances!==""?t.selectinstances.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<s.length;n++)s[n]+="}",s[n]=JSON.parse(s[n].replaceAll(/'/g,'"'));return t.selectinstances===""?i().createElement("div",null):i().createElement(C.Z,null,i().createElement(P.Z,{value:t[e.name],onChange:n=>{a({[e.name]:n.target.value})},input:i().createElement(O.Z,{name:"instances"}),label:E.I18n.t("vis_2_widgets_abfallkalender_instance"),style:{fontSize:"12.8px"}},s.map(n=>i().createElement(D.Z,{key:n.value,value:n.value,style:{fontSize:"16px"}},n.title))))}static showFontfamily(e,t,a){const s=new Set(["Arial","Arial Black","Bahnschrift","Calibri","Cambria","Cambria Math","Candara","Comic Sans MS","Consolas","Constantia","Corbel","Courier New","Ebrima","Franklin Gothic Medium","Gabriola","Gadugi","Georgia","HoloLens MDL2 Assets","Impact","Ink Free","Javanese Text","Leelawadee UI","Lucida Console","Lucida Sans Unicode","Malgun Gothic","Marlett","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Mongolian Baiti","MS Gothic","MV Boli","Myanmar Text","Nirmala UI","Palatino Linotype","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Historic","Segoe UI Emoji","Segoe UI Symbol","SimSun","Sitka","Sylfaen","Symbol","Tahoma","Times New Roman","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Copperplate","Courier","Courier New","Didot","DIN Alternate","DIN Condensed","Futura","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","Impact","Lucida Grande","Luminari","Marker Felt","Menlo","Microsoft Sans Serif","Monaco","Noteworthy","Optima","Palatino","Papyrus","Phosphate","Rockwell","Savoye LET","SignPainter","Skia","Snell Roundhand","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Zapfino"].sort());document.fonts.ready;const n=new Set;for(const r of s.values())document.fonts.check(`${t.fontsize}px "${r}"`)&&n.add(r);const o=[];for(const r of n)o.push({title:r,value:r});return i().createElement(C.Z,null,i().createElement(P.Z,{value:t[e.name],onChange:r=>{a({[e.name]:r.target.value})},input:i().createElement(O.Z,{name:"fontfamily"}),label:E.I18n.t("vis_2_widgets_abfallkalender_fontfamily"),style:{fontSize:"12.8px"}},o.map(r=>i().createElement(D.Z,{key:r.value,value:r.value,style:{fontSize:"16px"}},r.title))))}static showWasteTypes(e,t,a){const s="selectwastetypes"in t&&t.selectwastetypes!==""?t.selectwastetypes.replaceAll("[","{").replaceAll("]","}").replaceAll("#",'"').split("}").slice(0,-1):[];for(let n=0;n<s.length;n++)s[n]+="}",s[n]=JSON.parse(s[n].replaceAll(/'/g,'"'));return t.selectwastetypes===""?i().createElement("div",null):i().createElement(C.Z,null,i().createElement(P.Z,{value:t[e.name],onChange:n=>{a({[e.name]:n.target.value})},input:i().createElement(O.Z,{name:"wastetypes"}),label:E.I18n.t("vis_2_widgets_abfallkalender_wastetype"),style:{fontSize:"12.8px"}},s.map(n=>i().createElement(D.Z,{key:n.value,value:n.value,style:{fontSize:"16px"}},n.title))))}static showWhatsapp(e,t,a){return i().createElement(C.Z,null,i().createElement(g.Z,{checked:t[e.name],onChange:s=>{a({[e.name]:s.target.checked})},color:"primary"}))}static showBlink(e,t,a){return i().createElement(C.Z,null,i().createElement(g.Z,{checked:t[e.name],onChange:s=>{a({[e.name]:s.target.checked})},color:"primary"}))}getWasteTypes(e){return f(this,null,function*(){if(e==="")return"";let t=this.state.data.wastetype;const a=yield this.props.socket.getObjectViewSystem("instance","system.adapter.abfallkalender.","system.adapter.abfallkalender.\u9999").then(s=>{const n=[];return Object.keys(s).forEach(o=>{if(Object.keys(s).length===1||s[o]._id===`system.adapter.${e}`)for(let r=0;r<s[o].native.wasteTypes.length;r++)s[o].native.wasteTypes[r].used===!0&&n.push({value:s[o].native.wasteTypes[r].value,title:s[o].native.wasteTypes[r].title,whatsapp:s[o].native.wasteTypes[r].whatsapp,blink:s[o].native.wasteTypes[r].blink})}),n}).catch(s=>(console.log("ERROR !!!:"),console.log(s),[]));return this.state.editMode&&(yield this.arr2string(a).then(s=>{this.changeData({selectwastetypes:s})}),this.changeData({wastetypedisabled:a.length<2?"true":"false"})),this.initial===!0&&(!("wastetype"in this.state.data)||this.state.data.wastetype==="")&&(t=a.length>0?a[0].value:"",this.changeData({wastetype:t})),this.wastetypeLocal=t,t})}arr2string(e){return f(this,null,function*(){let t="";return e.map(a=>{t+="[",Object.keys(a).forEach((s,n)=>{n>0&&(t+=","),t+=`#${s}#: #${a[s].toString()}#`}),t+="]"}),t})}renderWidgetBody(e){return super.renderWidgetBody(e),i().createElement(m.Z,{class:`"card-trash${e.id}"`,style:{width:"100%",height:"100%"}},i().createElement(u.Z,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}},i().createElement(I.r,{class:`"trashicon${e.id}"`,ref:this.refTrashIcon})))}}_.default=(0,b.withStyles)(T)((0,b.withTheme)(c))},55973:function(L,_,l){var h=l(87462),i=l(63366),u=l(4819),g=l.n(u),m=l(15854),C=l.n(m),O=l(64983),D=l.n(O),P=l(13957),b=l(82500),R=l(89857),E=l(4502),B=l(67557);const A=["className","component"],W=T=>{const{classes:c}=T,p={root:["root"]};return(0,P.Z)(p,E.N,c)},I=(0,b.ZP)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(T,c)=>c.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),f=u.forwardRef(function(c,p){const e=(0,R.Z)({props:c,name:"MuiCardContent"}),{className:t,component:a="div"}=e,s=(0,i.Z)(e,A),n=(0,h.Z)({},e,{component:a}),o=W(n);return(0,B.jsx)(I,(0,h.Z)({as:a,className:D()(o.root,t),ownerState:n,ref:p},s))});_.Z=f},4502:function(L,_,l){l.d(_,{N:function(){return u}});var h=l(67402),i=l(85111);function u(m){return(0,i.Z)("MuiCardContent",m)}const g=(0,h.Z)("MuiCardContent",["root"]);_.Z=g},42577:function(L,_,l){var h=l(87462),i=l(63366),u=l(4819),g=l.n(u),m=l(15854),C=l.n(m),O=l(64983),D=l.n(O),P=l(13957),b=l(82500),R=l(89857),E=l(30464),B=l(53478),A=l(67557);const W=["className","raised"],I=c=>{const{classes:p}=c,e={root:["root"]};return(0,P.Z)(e,B.y,p)},f=(0,b.ZP)(E.Z,{name:"MuiCard",slot:"Root",overridesResolver:(c,p)=>p.root})(()=>({overflow:"hidden"})),T=u.forwardRef(function(p,e){const t=(0,R.Z)({props:p,name:"MuiCard"}),{className:a,raised:s=!1}=t,n=(0,i.Z)(t,W),o=(0,h.Z)({},t,{raised:s}),r=I(o);return(0,A.jsx)(f,(0,h.Z)({className:D()(r.root,a),elevation:s?8:void 0,ref:e,ownerState:o},n))});_.Z=T},53478:function(L,_,l){l.d(_,{y:function(){return u}});var h=l(67402),i=l(85111);function u(m){return(0,i.Z)("MuiCard",m)}const g=(0,h.Z)("MuiCard",["root"]);_.Z=g}}]);

//# sourceMappingURL=src_Abfallkalender_jsx.47a1ce51.chunk.js.map